# 微信小程序门控开关系统

## 系统概述
这是一个基于微信小程序和ESP8266的门控开关系统，可以通过小程序控制门的开关和停止动作。系统使用ESP8266的D0、D2和D3引脚控制继电器，实现对门控设备的控制。

### 新增功能
- **配网功能**：支持首次配网和断网后的重连，无需硬编码WiFi信息
- **看门狗功能**：内置看门狗定时器，提高系统稳定性，防止程序卡死
- **mDNS支持**：可以通过域名`doorcontrol.local`访问设备，无需记住IP地址


## 硬件准备
1. ESP8266开发板（如NodeMCU）
2. 继电器模块（3路）
3. 门控设备（如电机、电磁阀等）
4. 电源适配器
5. 连接线若干


## 硬件连接
- ESP8266 D0引脚 -> 继电器模块1控制端
- ESP8266 D2引脚 -> 继电器模块2控制端
- ESP8266 D3引脚 -> 继电器模块3控制端
- 继电器模块电源端 -> 外部电源
- 继电器模块公共端 -> 门控设备电源正极
- 继电器模块常开端 -> 门控设备控制端
- 门控设备电源负极 -> 外部电源负极

## 软件配置
### 1. ESP8266配置
1. 安装Arduino IDE并添加ESP8266开发板支持
2. 安装必要的库：
   - WiFiManager：用于配网功能
   - Ticker：用于看门狗喂狗定时器
3. 打开`esp8266_door_control.ino`文件
4. 将代码上传到ESP8266开发板
5. 首次上电后，ESP8266会自动进入配网模式

### 2. 微信小程序配置
1. 安装微信开发者工具
2. 导入项目到微信开发者工具
3. 编译并运行小程序
4. 在小程序中输入ESP8266的IP地址
6. 编译并运行小程序
7. 在小程序中输入ESP8266的IP地址

## 使用说明
### 1. 配网操作
1. 确保ESP8266已上电
2. 在小程序首页点击"配网"按钮
3. 按照提示扫描并连接到ESP8266的热点（名称包含"门控开关配网"）
4. 打开手机浏览器，访问地址`http://192.168.4.1`（已自动复制到剪贴板）
5. 在配网页面选择要连接的WiFi网络并输入密码
6. 等待ESP8266连接到WiFi网络
7. 配网成功后，小程序会自动获取ESP8266的IP地址

### 2. 门控操作
1. 确保ESP8266已连接到WiFi网络
2. 在小程序中会自动显示ESP8266的IP地址（或手动输入）
3. 点击"开门"按钮，控制门打开
4. 点击"关门"按钮，控制门关闭
5. 点击"停止"按钮，停止门的动作
6. 小程序会显示当前门的状态和操作日志

### 3. 看门狗功能
- 系统内置看门狗定时器，每3秒自动喂狗
- 如果程序卡死，看门狗会在8秒后自动重启ESP8266
- 提高了系统的稳定性和可靠性

## 注意事项
1. 确保硬件连接正确，避免短路
2. 继电器模块的控制逻辑可能不同，根据实际情况调整代码中的HIGH/LOW信号
3. 建议添加一个物理的紧急停止按钮，以确保安全
4. 确保ESP8266和手机连接到同一个WiFi网络
5. 门控设备的电源应根据设备规格选择合适的电源适配器
6. 配网时，请确保手机已打开WiFi功能
7. 如果ESP8266无法连接到WiFi网络，会自动进入配网模式
8. 可以通过访问`doorcontrol.local`来代替IP地址（需要设备支持mDNS）
## 故障排除
1. 如果小程序无法连接到ESP8266，请检查：
   - WiFi连接是否正常
   - ESP8266的IP地址是否正确
   - 防火墙是否阻止了连接
2. 如果继电器不动作，请检查：
   - 硬件连接是否正确
   - 继电器模块是否正常工作
   - ESP8266的引脚定义是否正确

## 版本历史
- v1.2.0：添加萤石云摄像头集成功能
- v1.1.0：添加配网功能、看门狗功能和mDNS支持
- v1.0.0：初始版本，实现基本的门控开关功能